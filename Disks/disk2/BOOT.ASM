;	SOURCE IS BOOT.ASM

DATAPORT	EQU	0A0H
STATPORT	EQU	0A1H
INREADY		EQU	01H
OUTREADY	EQU	80H

	ORG	100H
	LXI	SP,1000H
	IN	DATAPORT	;CLEARS JUNK/STATUS FROM INPUT PORT

;	MVI	A,0FFH		;DEBUG INIT
;	CALL	OUTCHAR

;	DELAY.........

	LXI	B,0
DELAY	DCR	C
	JNZ	DELAY
	DCR	B
	JNZ	DELAY

	CALL	OUTLIST
	DB	L1END-$-1	;LENGTH
	DB	9,0		;SET DRIVE 0

	DB	0,1		;BOOT ONE SECTOR
	DB	16H		;GET GENERAL STATUS
L1END:
	LXI	H,0000
	MVI	C,80H

LOOP:	CALL	INCHAR		;GET BYTE FROM BOOT SECTOR
	MOV	M,A		;STORE IN LOW MEMORY AREA
	INX	H
	DCR	C
	JNZ	LOOP		;IF MORE BYTES IN SECTOR

NODATA	CALL	INCHAR		;ACCEPT GENERAL STATUS
	JMP	0000		;GO FIRE UP BOOTSTRAP


OUTLIST:
	XTHL
	MOV	C,M
	INX	H
OUTLIST1:
	MOV	A,M
	INX	H
	CALL	OUTCHAR
	DCR	C
	JNZ	OUTLIST1
	XTHL
	RET

OUTCHAR:
	PUSH	PSW
OUTCHAR1:
	IN	STATPORT
	ANI	OUTREADY
	JNZ	OUTCHAR1
	POP	PSW
	OUT	DATAPORT
	RET
INCHAR:
	IN	STATPORT
	ANI	INREADY
	JZ	INCHAR
	IN	DATAPORT
	RET

	END
