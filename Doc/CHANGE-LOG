;
;VERSION: 1.1
;
;KK		NOTE: FOR CHANGES DONE BY DAVE KOSKI SEARCH FOR: KK
;********************************************************************
;	 DMA DISK CONTROLLER FIRMWARE									*
;	 COPYRIGHT (c) 1983 W/W COMPONENT SUPPLY						*
;																	*
;	 MACHINE READABLE SOURCE CODE IS AVAIABLE TO QUALIFIED			*
;	 CUSTOMERS. CALL US FOR MORE INFO.								*
;																	*
;	 WARNING: FEDERAL COPYRIGHT LAW PROHIBITS UNAUTHORIZED			*
;	 DISTRIBUTION.													*
;																	*
;********************************************************************
;	 STICKY LABEL: 97 TIME: 0800 DATE: 12 MAR 85
;
;-----------FIX--HISTORY------------------------
;
;
;	24 NOV (Turkey day) 1983
;		ADD 16 MS DELAY AFTER FLOPPY DISK 8<==>5 SWAP
;		SHOULD NOW DO SINGLE/DOUBLE ON 8" W/O READY CHANGE
;		(MOVED NECINT2..NECINT5 TO RPI. NAMES: RPINTx)
;
;	26 NOV 1983
;		CLEAN UP RPINTx CODE
;
;	03 DEC 1983
;		RPI NOW CHECKS RESSC FOR CORRECT CYILNDER W/ RETRY IF BAD
;
;	23 DEC 1983
;		DEBUG CODE TO TEST WHO~IS—TO-BE-THE—A:—DISK SWITCH SETTING
;
;	25 DEC (Merry Christmas) 1983
;		REMOVE 23 DEC DEBUG CODE
;		DOCUMENT SWITCH SETTING
;		REMOVE DEBUG DELAYS FOR 5" FLOPPY
;		USED RRC/JNC INSTED OF ANI/JZ IN GETHOST
;		PULLED ALL DEBUG CALLS
;		SET RAM SIZE TO 12K
;
;	26 DEC 1983
;		(25 DEC SYSTEM DID NOT WORK)
;		INITSPEC USED INSTED 0F HEX CONSTANT FOR STEP RATE SETTING IN INIT
;		PUT RAM BACK TO 16K —- AND BACK TO 12K
;		RESTORE ANI/JZ TO PRE—CHRISTMAS USE -— AND BACK TO CHRISTMAS
;		RESTORE PBUFFER: AND DELETE
;		RESTORE EXTRA DELAYS
;
;	27 DEC 1983
;		PULL DELAYS IN NECSERV AND WNB2
;
;	28 DEC 1983
;		SET RAM SIZE TO 10K
;
;	03 JAN 1984
;		HAPPY NEW YEAR
;		ONLY A: DEFINED AT POWER ON, SWITCH SETTING DEFINES DISK
;
;	05 JAN 1984
;		FIX 03 JAN CODE. FORCE UNDEFINE ALL BUT A: DISK.
;	
;	06 JAN 1984
;		REMOVE DROP-DEAD*ON-ERROR SUBROUTINE
;		CHANGE AND DOCUMENT SEVERAL UNIQUE ERROR CODES
;		REMOVE SEEK—TO—INNER FROM RWRETRY ETC
;
;	11 JAN 1984
;		ADDED HARD DISK STUFF BCW
;
;	29 FEB (leap day) 1984
;		SPLIT INTO 25 SECTIONS
;		MADE ALL THINGS NEW UNDER THE GETDPB COMMAND
;		NEW GETDPB: FIXED BAD JMP THAT STOPPED SD DISKETTS FROM WORKING
;
;	01 MAR 1984
;		NEW GETDPB: FIXED WRONG REGISTER IN LOCDPB FDRELTAB SEARCH
;		NEW GETDPB: ADDED MISSING CODE TO LOCDPB
;
;	02 MAR 1984
;		NEW GETDPB: YET ANOTHER FIX IN THE NEW FDREL SEARCH
;		RESTORED PART OF FMT MESSED UP IN DOING NEW GETDPB
;
;	05 MAR 1984
;		STILL 5“ SYSWRT PROBLEM
;		ADDED RE-ORGANIZED HARD DISK CODE WITH 3 DIVIDE ROUTINES
;		REMOVE ALL "PRIORITY BUFFER" STUFF
;
;	09 MAR 1984
;		REMOVED “PRIORITY BUFFER" LENGTH FROM MAKECUR
;		ADDED ZAP OF "WDDEV" TO DEV CHANGE IN MAKECUR (BOOT PROBLEM)
;
;	11 MAR 1984
;		REMOVE SOME DEBUG CODE
;		PULL GARBAGE (??) FROM HDINIT
;
;	16 MAR 1984
;		FIX HD$DPB ALLOC COUNT
;		START TO MAKE VERIFY ONLY ON HARD DISK WORK
;		MAKE HD FORMAT WRITE ES’S TO ALL SECTORS
;
;	17 MAR (Have a nice St. Pat's day.) 1984
;		HDINIT NOW USES (OPTIONAL) RECAL PLUS SEEK [NOT RECAL + RECAL]
;
;	18 MAR 1984
;		FIX MORE OF HDINIT
;
;	19 MAR 1984
;		AGAIN REMOVE UNCONDITIONAL HEAD LOAD AND RECAL AFTER RESET
;		** DEBUG VERSION: SA712 HAS ONLY 3 HEADS
;
;	20 MAR 1984
;		MADE WRITE AN INTERNAL SUBROUTINE TO HELP SYSWRT WHEN NO
;		VALID ID CAN BE READ FROM FLOPPY DISK TRACK
;
;	22 MAR 1984
;		ADDED SEVERAL NEW FD FORMATS IN FDREL
;
;	25 MAR 1984
;		PUT SA712 BACK TO 4-HEAD DEVICE
;
;	27 MAR 1984
;		READID ON SIDE 2 OF 5.25" FLOPPIES FOR DOUBLE-SIDED CHECK
;		REMOVE "SETHEAD“ USE FROM “GETDPB" FUNCTION
;
;	29 MAR 1984
;		BOOT/SYSWRT TO USE (DPB) LOGICAL SECTORS/LOGICAL TRACK
;		REMOVED CURLDT AREA
;		ZAPPED BUFSIDE IN MAKECUR TO KEEP FWT FROM ACTING UP
;
;	30 MAR 1984
;		5.25“ SIDE 2 READID ERROR NO LONGER LEFT IN GENSTAT
;
;	01 APR (tax time approaches...no foolen) 1984
;		CHANGED 5.25“ STEP RATE TO 16 Ms FOR DEBUG
;		FIXED 8/5 STEP RATE SETUP NEAR MAKEC1A
;
;	05 APR 1984
;		ZEROED CPSSSIDE BEFORE LOCDPB CALL IN BOOT/SYSWRT
;		5.25“ STEP RATE BACK TO 5MS
;
;	06 APR 1984
;		FIXED SETSKEW FUNCTION (SKEW BYTE ADDRESS WAS MESSED UP)
;
;	10 APR (property tax day) 1984
;		ADDED GET ROUTINES FOR EXTENDED DPB AND MS—DOS BPB
;		EXTENDED COMMAND TABLE FOR NEW OPCODES
;		CHANGED END—OF—TABLE EQUATE
;		MOVED FF OPCODE INTO COMAND TABLE
;
;	12 APR 1984
;		ADDING EXTENDED DPB AND BPB STUFF...
;		AT THIS POINT WE ARE USING 128—BYTE LOGICAL SECTORS
;
;	14 APR (At last my federal tax refund came —- just in time to pay state tax)
;		ADDING CODE FOR PHYSICAL FORMAT I/O
;		MAX LENGTH FOR HARD DISK IS 2000 (NOT 2048) ALLOC UNITS
;
;	15 APR 1984
;		PHYSICAL MODE I/O DONE...NOW TO DEBUG
;
;	16 APR 1984
;		FIXED STUPID BUG IN INBUFREAD/WRITE -- NEED “0080H” NOT JUST “0080“
;
;	17 APR 1984
;		FIXES IN MS-DOS BPB GENERATOR
;		FIXED WRONG SENSE OF RTN ON PFIOFLAG IN HARD DISK BUFFER ADDRESS
;		FIXED BAD LENGTH IN 200H & 400H SECTOR SIZE
;
;	18 APR 1984
;		FIXED BAD LENGTH IN FLOPPY DISK GETDPB
;		FIX BAD LENGTH IN PHYS FORMAT WRITE
;
;	19 APR 1984
;		MORE LITTLE CHANGES IN INBUF READ/WRITE LENGTH USAGE
;		MULTI—LOGICAL-SECTOR DMA XFERS JUST MIGHT NOW WORK
;
;	20 APR 1984
;		ADDED 5" DD 512-BYTE 9 SECTOR FORMAT
;		PULLED DD 128 FORMATS
;		ADJUSTED 5“ DD 1024-BYTE 5 SECTOR FORMAT
;
;	23 APR 1984
;		FIXED HANG IN PHYS MODE WRITE
;
;	25 APR 1984
;		CHANGED GET MEDIA CHANGE STATUS STUB TO REAL ROUTINE
;		MEDIA CHANGE STAT PUT INTO GETDPB, NECSERV AND UNLOAD
;
;	26 APR 1984
;		MEDIA CHANGE STATUS PUT INTO 8<==>5 SWAP
;		HARD DISK DPB EXTENDED FOR MS-DOS ETC
;		MASK ST3 BEFORE USING TO MAKE DEVICE TABLE ADDRESS
;
;	27 APR 1984
;		PUT A BUNCH OF CHANGES INTO ’MOST ALL MY DMA CODE

;	30 APR 1984
;		FIX LOCAL DMA ADDRESS IN MEMORY DISK READ
;
;	02 MAY 1984
;		CORRECTED DPB EXTENSION FOR CP/M+
;
;	03 MAY 1984
;		ADDED # SIDES CHECK IN FORMAT
;		RECAST (FLOPPY DISK) FORMAT AND VERIFY INTO SEPARATE SUBROUTINES
;
;	04 MAY 1984
;		BUG FIXES IN CHANGED FORMAT STUFF
;
;	09 MAY 1984
;		MOVED CODE FROM INITALL TO INIT TO STOP FWT AFTER RESET
;
;	11 MAY 1984
;		DEBUG TURNED ON TO FIND STRANGE HANG
;
;	12 MAY 1984
;		MS—DOS SS 5" FD TO ONE PHYSICAL SECTOR PER ALLOCATION UNIT
;
;	13 MAY 1984
;		DEBUG TURNED OFF (FMT BUG KILLED ONLY DISKETTE GIVING STRANGE HANG)
;		FORMAT CODE FOR NUMBER—OF—SIDES CHECK NOW IN PLACE
;		FORMAT CODE FOR KILL BACK SIDE OF DISKETTE NOW IN PLACE
;
;	14 MAY 1984
;		HARD DISK BPB FIXED (’TWAZ OFF BY 4 BYTES)
;		SEEK TO GIVEN TRACK BEFORE DOING NUMBER—OF—SIDES CHECK USING WRITE
;
;	21 MAY 1984
;		BPB FIX IN 8“ 8 1024—BYTE SINGLE DENSITY
;		DEFINE "SET FLOPPY DISK PARAMETERS" COMMAND
;		VARIOUS CHANGES TO USE VALUES SET IN ABLVE NEW COMMAND
;		INIT PART OF RAM BY A LIST COPY
;
;	23 MAY 1984
;		DEFINE MS—DOS FAT SIZE FOR FLOPPY USING MATH INSIDE MACRO
;		IMPLEMEMT HEAD SETTLE DELAY IN WAITNBUSY
;		PUT REPLY TO SETSKEW COMMAND IN GENERAL STATUS
;
;	29 MAY 1984
;		POWER-ON BUG FIXED (READ AND TRASH DONE TWICE)
;
;	04 JUN 1984
;		FIX FOR 8“ GET—MEDIA~CHANGE STATUS
;
;	05 JUN 1984
;		FIX FOR ALL FLOPPY GET—MEDIA—CHANGE STATUS
;
;	24 JUN 1984
;		FOR MS-DOS 8“DS 1024~BYTE SECTORS: 1 SECTOR = 1 ALLOCATION UNIT
;
;	25 JUN 1984
;		BETTER CHECK FOR READY CHANGE IN NECSERV
;
;	26 JUN 1984
;		FIX STUPID BUG IN PHYSICAL (OPS 1E/1F) HARD DISK READ/WRITE
;
;	27 JUN 1984
;		NEW SUBROUTINE OF NECSERV TO TAKE ALL INTERRUPT STAT BEFORE
;		DOING ANYTHING ELSE (RECURSIVE SUBROUTINE)
;
;	19 JUL 1984
;		PART WAY TO COMMON HARD DISK STUFF:
;		NUMBER OF HEADS IS IN MEMORY
;		(HARD DISK) CONTROLLER **ECC/NO-ECC** TYPE IS IN MEMORY
;
;	20 JUL 1984
;		BUG FIXES FROM 19 JUL:
;		BAD VALUE FOR CTLR TYPE
;		N0 “RET” IN DIVIDE SUBROUTINE
;
;	26 JUL 1984
;		MORE COMMON HARD DISK STUFF:
;		STEP RATE NOW IN MEMORY BYTE
;		HAVE HARD DISK DEVICE TABLE ENTRY FOR 0S TABLE (DPB/BPB/WHATEVER)
;
;	27 JUL 1984
;		MOVED STEP RATE SETTER TO ABOVE HDINIT TO ALSO SET STEP RATE
;
;	28 JUL 1984
;		ADDED PRECOMP CYL TO MEMORY PARAMETER
;		GETDPB ETC NOW USE OS BLOCK IN HARD DISK DEVICE TABLE
;		FIXED BAD REGISTER IN GETDPB ETC FROM HARD DISK
;
;	29 JUL 1984
;		HD BOOT SHOULD NOW WORK-—SECTORS/TRK NO LONGER FROM DPB
;		HD I/O CODE NOW USES DEV SEL AND HARDWARE OFFSET
;
;	31 JUL 1984
;		CHANGED GET OF MEMORY DISK PARAMETER STUFF
;		STRUCTURE NOW: INIT FLAG, FOUR LEN/LOC PAIRS, LEN OS BLOCK, OS BLOCK
;		(PRIOR STRUCTURE HAD INIT FLAG LAST AND ONLY DPB ALLOWED)
;
;	01 AUG 1984
;		CHANGED TO RETURN MEM DISK OS BLOCK DEFINED YESTERDAY
;
;	02 AUG 1984
;		BOOT/SYSWRT CODE TO SWAP CTLR TYPE ON CERTAIN HARD DISK ERRORS
;		"JMP BOOTSUB" NOW SETUP IN INITALL LIST
;		INSTALL DEBUG CODE SO I CAN SEE HARD DISK ERROR CODE IN BOOT
;		(Brent is so very busy this year)
;
;	03 AUG 1984
;		INSTALL MORE DEBUG CODE (SEE 02 AUG)
;		TRY EC=40 (BUT CHECK IF FLOPPY ERROR CODE)
;		ITS OK W/ ECC CONTROLLER. FLOPPY DOES NOT MAKE EC=40.
;
;	04 AUG 1984
;		PULL DEBUG CODE IN BOOT/SYSWRT
;		SKEW FACTOR FROM SEEKSEC USED IN HARD DISK FORMAT
;
;	05 AUG 1984
;		MOVE ZERO OF SEEKSEC OUT OF EARLY PART OF FMTTRK
;
;	10 SEP 1984
;	FIX PHYSICAL SECTOR READ/WRITES FOR HARD DISK, MOSLTLY WRITES
;	ADD FAST READ/WRITES FOR PHYSICAL NON DMA HARD DISK
;
;	06 NOV (election day) 1984
;		CORRECT MEDIA BYTES FOR IBM-PC COMPATABILITY; MAKE ALL UNIQUE
;		PULL SOME OLD COMMENTED—OUT HARD DISK STUFF
;
;	20 NOV 1984
;	TRIM .75 USEC/BYTE OFF NON—DMA FULL SECTOR HARD DISK READ
;	RESTORE HARD DISK FWT WITH HD FULL SECOTR NON—DMA READ/WRITE
;
;	26 NOV 1984
;		PUT BRENTS HEX PATCHES OF FDRELTAB INTO SOURCE
;		ADD IGNORE FD ERROR OPCODE
;
;	*** 1985 ***
;
;	16 JAN 1985
;		ADD OPCODES TO SET AND GET (SEPARATE) HARD DISK PARAMS
;
;	11 MAR 1985
;		MORE OF THE SAME...
;
;	12 MAR 1985
;		GETTING THE FINAL BUGS OUT OF THE ABOVE
;		MOVED HDINIT CALL INTO INITALL
;
;
;		ORGANIZATION OF THIS CODE....
;
;		1. EQUATES
;		2. "RST" AREA
;			RST 0: POWER ON/RESET JMP
;			RST 4..7 JMP TO THE ONE—BYTE NEC/HOST READ/WRITE ROUTINES
;		3. FINISH RESET PROCESSING
;			IDLE LOOP
;			COMMAND DECODE
;			COMMAND TABLE
;		4. POWER—ON INIT
;		5. VARIOUS SHORT COMMAND PROCESSORS
;		6. THE ONE-BYTE NEC/HOST READ/WRITE ROUTINES
;		7. BOOT/SYSWRT ORGANIZER
;		8. FLOPPY DISK SEEK STUFF
;		9. FLOPPY DISK HEAD LOAD
;		10. FORMAT TRACK MAINLINE AND FLOPPY DISK FORMAT
;		11. CALCLUATE PHYSICAL SECTOR FOR FLOPPY DISK
;		12. FLOPPY DISK READ/WRITE
;		13. FLOPPY DISK READ—PHYSICAL—ID (FOR DENSITY INFO)
;		l4. FLOPPY DISK FORCE WRITE (OF MODIFIED SECTORS), DUMP BUFTAGS
;		15. NEC INTERRUPT SERVICE WITH ERROR CODE GENERATOR AND RESET$NEC
;		16. ALL HARD DISK ACCESS CODE
;		17. ALL DMA STUFF (FOR NORMAL READ/WRITE, MEM DISK AND MOVE MEMORY)
;		18. BLOCK TRANSFER TO/FROM HOST AND RELATED STUFF
;		19. SETUPS FOR PHYSICAL DISK CHANGE
;		20. LOGICAL/PHYSICAL DEVICE SUBROUTINES
;		21. SET AND USE RETRY COUNTERS
;		22. SET SKEW (HOST CALL); BUILD FPY SKEW TABLE, FPY SECTOR OFFSET STUF
;			RETURN VERSION NUMBER (1.1 AND LATER)
;		23. MACROS TO HELP BUILD FDREL; FDREL; HARD DISK DPB
;		24. DEBUG SUBROUTINE
;		25. RAM ORGANIZATION
;
;	KK 22 MAR 1986
;		DAVE COMPLETES MODIFICATIONS
;		FUNCTIONS ADDED:
;		SETRAMDPB	36 24 SET FLOPPY DPB AND PARAMETERS
;		GETRAMDPB	37 25 GET FLOPPY DPB AND PARAMETERS
;		DORID		38 26 READ I.D. INFO TO EXTENDED STATUS
;		INDIVSTEP	39 27 SET INDIVIDUAL STEP RATES
;		SETTPI		40 28 SET TRACK DENSITY STATUS (48—96 TPI)
;		GETTPI		41 29 INVERSE OF ABOVE
;		GETVERS		42 2A RETURN VERSION TO HOST
;		DUMPTAGS	43 ZB RETURN BUFTAGS TO HOST
;
;		ADDITIONAL NOTES:
;			— 48 TPI DISKS MAY BE USED IN 96 TPI UNITS. USE FUNCTION 40 28H TO
;			SET/RESET THIS ATTRIBUTE. IF SET, CPS$TRACK:= CPS$TRACK * 2.
;	
;			- DPB PARAMETER "OFF" IS NOW TRACK OFFSET AND NOT CYLINDER OFFSET.
;			THIS MAKES IT POSSIBLE TO R/W KAYPRO IV DISKS AND OTHERS WHICH HAVE
;			A ONE TRACK (NOT ONE CYLINDER) OFFSET. FOR SINGLE SIDED DISKS, TRACK
;			OF COURSE IS SAME AS CYLINDER. CPS AND FDREL HAD TO BE MODIFIED
;			TO SUPPORT THE ABOVE. SEPERATE ENTRY IS NOW AVAILABLE FOR SEEK$CPS.
;
;			- WHEN A SEEK TRACK (CPS$TRACK) IS GREATER THAN THE NUMBER OF
;			CYLINDERS OF A FLOPPY UNIT, CPS$SIDE IS INCRIMENTED AND THE NUMBER
;			OF PHYSICAL CYLINDERS IS SUBTRACTED FROM CPS$TRACK. THIS MAKES IT
;			POSSIBLE TO R/W DISKS THAT ALLOCATE SIDE ZERO COMPLETELY BEFORE
;			ALLOCATING ANYTHING TO SIDE ONE (LIKE VECTOR GRAPHICS).
;	
;			- EVEN WITH THE ABILITY TO ADD A BIAS T0 SECTOR AND SIDE IDs
;			(FUNCTION 36 24H), IT IS ALAS, STILL NOT POSSIBLE TO R/W SOME TYPES.
;			OF THOSE ARE DISKS THAT HAVE EVEN PHYSICAL SECTOR ID NUMBERS ON ONE
;			SIDE AND ODD ON THE OTHER, DISKS THAT HAVE FALSE "R" ID FIELDS
;			(COMPUGRAPHIC USES FE, PRESUMABLY THEY USE A WESTERN DIGITAL 179x
;			CONTROLLER), DISKS THAT ARE BYTE COMPLEMENTED (THOUGH THE BIOS
;			COUD FIX THAT), ETC.
;	
;	KK 27 APR 1986
;		BUG FOUND: RECAL NOT WORKING ON 96 TPI SOMETIMES BECAUSE
;		NEC STEPS IN 77 TIMES AND GIVES UP
;		SOLUTION: ON RECAL, DO IT TWICE UNCONDITIONALLY. IF IT WORKED
;		THE FIRST TIME, SO WHAT? LITTLE TIME IS WASTED TRYING SECOND TIME.
;	
;	KK 07 DEC 1986
;		ADD FUNCTIONS TO ENABLE HOST DIAGNOSTIC SOFTWARE TO USE DYSAY DDD
;		(DIGITAL DIAGNOSTIC DISKETTE) FOR ALIGNMENT, ETC. FUNCTIONS INCLUDE
;		ADDING BIT TO PARAMETER OF HOST FORMAT COMMAND SO THAT HOST MAY CALL
;		OMNI TO “VERIFY" A TRACK STARTING AT A GIVEN PHYSICAL SECTOR. ALSO
;		A FUNCTION HAS BEEN ADDED TO RETURN THE BUFTAGS TO “SEE“ WHICH SECTORS
;		HAVE BEEN SUCCESFULLY READ. A FUNCTION TO RETURN OMNI FIRMWERE VERSION
;		NUMBER (STARTING 11H FOR 1.1 “AA11.ASM“) TO HOST HAS BEEN ADDED.
;	
;	KK 22 DEC 1986
;		BUG IN BOOT FIXED. LOCDPB WAS USING SEEKTRK (WHICH IS SEEK CYLINDER)
;		AND R/W IN BOOT WAS USING CPS$TRACK. THIS CAUSED LOCDPB TO REPORT THE
;		DENSITY OF THE WRONG TRACK OF 8 INCH IN WHICH THE BOOT CYLINDER IS OF
;		A DIFFERENT DENSITY. FAILURE WAS ON THE SECOND TRACK.
;	
;		I DON’T LIKE THE WAY POWER ON INITIALIZATION WAS DONE. THE ORDER HAS
;		BEEN CHANGED. TABLES WERE BEING ACCESSED BEFORE THEY WERE BEING INIT—
;		IALIZED - I THINK.
;	
;	KK 30 DEC 1986
;		COMPLETED TIMER FOR PREAD/PWRITE TO CHECK DRQ FROM 765 TO SEE IF
;		WE HAVE A 5 INCH WITHOUT A DISK. ON TIMEOUT THE 765 IS RESET
;		(REQUIRES HARDWARE MOD.) AND AN ERROR CODE IS FAKED AND THEN
;		EXECUTION RESUMES AN "BEGIN$0" WHICH RESETS STACK AND WAITS FOR
;		HOST COMMANDS (MAIN IDLE LOOP). LOCDPB NOW ALSO TIMES OUT AND FAKES
;		AN ERROR CODE. THE DRQ CHECK IS DONE BY A RIM INSTRUCTION. THIS ALSO
;		REQUIRES A HARDWARE MODIFICATION AND PROBABLY RENDERS THIS FIRMWARE
;		INCOMPATABLE WITH UNMODIFIED BOARDS. IT IS A SIMPLE ONE THOUGH.
;
;		SIMPLY CONNECT SID OF 8085 TO DRQ OF 765 — NO CUT TRACES.
;	
;	KK 31 DEC 1986 (11:55 P.M. happy new year)
;		FIXED BUG IN FORMAT. WAS NOT SETTING CPS$SIDE TO 0 RESULTING IN
;		INCORRECT NUMBER OF SIDES REPORT. WAS FORMATTING DOUBLE SIDED
;		DISKS SINGLE SIDED SOMETIMES DEPENDING ON THE VALUE THAT HAPPENED
;		TO BE IN CPS$SIDE.
;	
;		ALSO FORCED 2 SIDED TRUE ON ALL 5 INCH AND FIXED A STACK PROBLEM
;		AT PRWlO, THE RETURN ROUTINE OF PHYSICAL R/W.
;